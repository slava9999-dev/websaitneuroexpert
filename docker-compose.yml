version: '3.8'

services:
  frontend:
    image: node:20
    working_dir: /app
    command: bash -c "npm install && npm run start"
    volumes:
      - ./frontend:/app
    environment:
      - NODE_ENV=development
      - REACT_APP_BACKEND_URL=http://localhost:8000
    ports:
      - "3000:3000"
    depends_on:
      - backend
    networks:
      - neuroexpert-network

  backend:
    image: python:3.11
    working_dir: /workspace
    command: bash -c "pip install --no-cache-dir -r backend/requirements.txt && uvicorn api.index:app --host 0.0.0.0 --port 8000 --reload"
    volumes:
      - ./:/workspace
    environment:
      - PYTHONUNBUFFERED=1
      - MONGO_URL=${MONGO_URL:-mongodb://mongodb:27017/neuroexpert_db}
      - DB_NAME=${DB_NAME:-neuroexpert_db}
      - EMERGENT_LLM_KEY=${EMERGENT_LLM_KEY:-}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}
      - CLIENT_ORIGIN_URL=${CLIENT_ORIGIN_URL:-http://localhost:3000}
    ports:
      - "8000:8000"
    depends_on:
      - mongodb
    networks:
      - neuroexpert-network

  mongodb:
    image: mongo:7.0
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=admin123
    networks:
      - neuroexpert-network

volumes:
  mongodb_data:

networks:
  neuroexpert-network:
    driver: bridge
